{% extends "base.html" %}
{% load static %}

{% block title %}Analysis{% endblock %}

{% block content %}

<!-- ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—  -left-fullã§åˆæœŸã¯ç”»é¢å¤–ã«å‡ºã—ã¦ãŠã -->
<div id="hover-tooltip"
     class="fixed -left-full pointer-events-none transition-opacity duration-200 z-50 bg-gray-800 text-white text-[10px] py-1.5 px-3 rounded shadow-xl whitespace-nowrap">
  ğŸ’¡ ã‚¯ãƒªãƒƒã‚¯ã§ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡¨ç¤º
</div>

<!-- ãƒœãƒƒã‚¯ã‚¹å…¨ä½“ -->
<div class="min-h-screen py-10 px-4 space-y-6">
  <div class="max-w-7xl mx-auto bg-white shadow-xl rounded-lg">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼å¸¯ -->
    <div class="bg-teamy-navy px-5 py-1 rounded-t-lg flex justify-between items-center min-h-[64px]">
      <div class="flex items-center gap-3 m-2">
        
        <div id="team-select-container" class="relative group flex items-center min-h-[44px]">
          <button type="button" class="flex items-center text-white text-xl font-bold hover:opacity-80 transition-opacity focus:outline-none">
            <span id="selected-team-name">
              {% if team_id %}
                {% for team in teams %}
                  {% if team.id == team_id %}
                    {{ team.name }}
                  {% endif %}
                {% endfor %}
              {% else %}
                ãƒãƒ¼ãƒ ã‚’é¸æŠ
              {% endif %}
            </span>
            <svg class="ml-2 w-5 h-5 transition-transform duration-200 group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>

          <div class="absolute top-full left-0 mt-1 whitespace-nowrap min-w-[200px] bg-white border border-gray-100 shadow-xl rounded-md py-2 invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all duration-200 z-[100]">
            {% for team in teams %}
              <a href="?team_id={{ team.id }}&tab=team" 
                class="block px-6 py-3 text-gray-800 hover:text-teamy-teal hover:bg-gray-50 text-lg {% if team.id == team_id %}font-bold text-teamy-teal{% endif %}">
                {{ team.name }}
              </a>
            {% endfor %}
          </div>
        </div>

        <span id="header-title-text" class="text-white text-lg font-bold tracking-wider self-center" 
        data-user-name="{{ target_user.name }}">
          ã¨ {{ target_user.name }} ã•ã‚“ã®ä¾¡å€¤è¦³
        </span>

        <!-- [ï¼Ÿ]ãƒ˜ãƒ«ãƒ—ãƒªãƒ³ã‚¯ -->
        <button type="button" class="btn-help h-6 w-6 transition-transform hover:scale-110">
          <img src="{% static 'imgs/help.png' %}" alt="ã¸ãƒ«ãƒ—ã‚’è¡¨ç¤º">
        </button>
      </div>

      <!-- ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆ†æãƒœã‚¿ãƒ³ -->
      {% if is_team_leader %}
      <a id="manager-btn" href="{% url 'analysis:managers_page' %}?team_id={{ team_id }}"
        class="self-center inline-block bg-teamy-teal hover:bg-teamy-tealDark hover:scale-[1.03] active:scale-[0.98] transition-transform text-white font-semibold px-5 py-1.5 rounded-full shadow-sm text-xs">
        ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼å‘ã‘åˆ†æã¸
      </a>
      {% endif %}
    </div>

<!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
<div class="p-8">

  <!-- ã‚¿ãƒ–è¡Œï¼ˆæ§‹é€ ãã®ã¾ã¾ï¼‰ -->
  <div class="flex border-b border-gray-100 mb-4">
    
    <!-- å·¦ï¼šã‚¿ãƒ– -->
    <div class="flex gap-8">
      <button id="tab-me-btn"
              class="px-6 py-2 text-gray-400 text-base font-bold">
        ã‚ãªãŸã®ä¾¡å€¤è¦³
      </button>

      <button id="tab-team-btn"
              class="px-6 py-2 text-teamy-teal text-base font-bold border-b-2 border-teamy-teal -mb-[1px]">
        ãƒãƒ¼ãƒ ã¨ã®æ¯”è¼ƒ
      </button>
    </div>

  </div>

      <!-- ã‚ãªãŸã®ä¾¡å€¤è¦³ãƒšãƒ¼ã‚¸ -->
      <div id="content-me" class="relative min-h-[400px]">

        {% if graph_data %}
          {% include "analysis/includes/personal_me.html" %}
        {% else %}
          <!-- ãƒã‚¹ã‚¯ -->
          <div class="absolute inset-0 z-30 bg-teamy-grayDark/60 rounded-xl flex justify-center items-start pt-32">
            <div class="text-center p-8 bg-teamy-grayLight rounded-2xl max-w-md w-full mx-4">
              <p class="text-teamy-grayText leading-relaxed mb-6">
                è¡¨ç¤ºã§ãã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“<br>
                ã¾ãšã¯è³ªå•ã«å›ç­”ã—ã¦ãã ã•ã„
              </p>
              <a href="{% url 'analysis:questions_start' %}"
                class="self-center inline-block bg-teamy-teal hover:bg-teamy-tealDark hover:scale-[1.03] active:scale-[0.98] transition-transform text-white font-semibold px-6 py-2 rounded-full shadow-md text-sm">
                Questions ã‚¹ã‚¿ãƒ¼ãƒˆ
              </a>
            </div>
          </div>

          <div class="opacity-20 grayscale pointer-events-none">
            {% include "analysis/includes/personal_me.html" %}
          </div>
        {% endif %}
      </div>

      <!-- ãƒãƒ¼ãƒ ã¨ã®æ¯”è¼ƒãƒšãƒ¼ã‚¸ -->
      <div id="content-team" class="hidden relative min-h-[400px]">

        <!-- æœªå›ç­”è¡¨ç¤ºï¼ˆãƒãƒ¼ãƒ æ¯”è¼ƒãƒšãƒ¼ã‚¸ã®ã¿ï¼‰ -->
        <div class="flex justify-end pb-2">
          {% if not allmember_answered %}
            <div class="px-4 py-1 rounded-md bg-teamy-pinkRed/10">
              <span class="text-sm text-teamy-pinkRed">
                âš ï¸ è³ªå•ã«æœªå›ç­”ã®ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã™
              </span>
            </div>
          {% endif %}
        </div>

        {% if team_id and graph_data and team_graph_data %}
          {% include "analysis/includes/personal_team.html" %}
        {% else %}
          <!-- ãƒã‚¹ã‚¯ -->
          <div class="absolute inset-0 z-30 bg-teamy-grayDark/60 rounded-xl flex justify-center items-start pt-32">
            <div class="text-center p-8 bg-teamy-grayLight rounded-2xl max-w-md w-full mx-4">
              <p class="text-teamy-grayText leading-relaxed">
                ãƒãƒ¼ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚<br><br>
                ãƒãƒ¼ãƒ ã«æ‰€å±ã™ã‚‹ã“ã¨ã§<br>
                çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
              </p>
            </div>
          </div>

          <div class="opacity-20 grayscale pointer-events-none">
            {% include "analysis/includes/personal_team.html" %}
          </div>
        {% endif %}

      </div>
    </div>
  </div>
</div>

<!-- ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
{{ graph_data|json_script:"personal-graph-data" }}
{{ advice_data|json_script:"personal-advice-data" }}

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
{% include "analysis/modals/analysis_guide.html" %}

{% endblock %}

{% block extra_js %}
<script src="{% static 'analysis/personal_analysis.js' %}"></script>
{% endblock %}
