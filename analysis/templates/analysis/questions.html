{% extends "base.html" %}
{% load static %}
{% block title %}Questions{% endblock %}

{% block content %}

<div class="min-h-screen">
  <form id="question-form" method="POST" action="#"
        class="max-w-4xl mx-auto p-8 space-y-16 pt-[10vh] pb-[30vh]">
    {% csrf_token %}

    {% for q in page_obj.object_list %}
      <div class="question-block space-y-8 scroll-mt-[30vh]">

        <!-- ===== 質問文 ===== -->
        <p class="text-lg leading-relaxed text-slate-800 pb-3">
          {{ q.text }}
        </p>

        <!-- ===== 回答UI ===== -->
        <div class="flex items-center justify-between max-w-2xl mx-auto">
          <span class="text-teamy-orange font-semibold md:text-base whitespace-nowrap">
            そう思う
          </span>

          <div class="flex items-center gap-4 md:gap-8">

            <!-- 2 -->
            <label>
              <input type="radio" name="q_{{ q.id }}" value="2" data-qid="{{ q.id }}"
                     class="peer hidden answer">
              <div class="w-12 h-12 rounded-full border-2 border-teamy-orange peer-checked:bg-teamy-orange"></div>
            </label>

            <!-- 1 -->
            <label>
              <input type="radio" name="q_{{ q.id }}" value="1" data-qid="{{ q.id }}"
                     class="peer hidden answer">
              <div class="w-9 h-9 rounded-full border-2 border-teamy-orange peer-checked:bg-teamy-orange"></div>
            </label>

            <!-- 0 -->
            <label>
              <input type="radio" name="q_{{ q.id }}" value="0" data-qid="{{ q.id }}"
                     class="peer hidden answer">
              <div class="w-7 h-7 rounded-full border-2 border-gray-400 peer-checked:bg-gray-400"></div>
            </label>

            <!-- -1 -->
            <label>
              <input type="radio" name="q_{{ q.id }}" value="-1" data-qid="{{ q.id }}"
                     class="peer hidden answer">
              <div class="w-9 h-9 rounded-full border-2 border-teamy-teal peer-checked:bg-teamy-teal"></div>
            </label>

            <!-- -2 -->
            <label>
              <input type="radio" name="q_{{ q.id }}" value="-2" data-qid="{{ q.id }}"
                     class="peer hidden answer">
              <div class="w-12 h-12 rounded-full border-2 border-teamy-teal peer-checked:bg-teamy-teal"></div>
            </label>

          </div>

          <span class="text-teamy-teal font-semibold md:text-base whitespace-nowrap">
            そう思わない
          </span>
        </div>

      </div>

      {% if not forloop.last %}
        <hr class="border-gray-200">
      {% endif %}
    {% endfor %}

    <!-- ===== ページ操作 ===== -->
    <div class="pt-10 space-y-10">
      <div class="flex justify-between items-center max-w-sm mx-auto">

        <!-- 戻る -->
        <div>
          {% if page_obj.has_previous %}
            <a href="{% url 'analysis:question_page' page_obj.previous_page_number %}"
               class="inline-flex items-center justify-center bg-teamy-teal text-white px-10 py-3 rounded-full font-medium hover:opacity-90">
              戻る
            </a>
          {% endif %}
        </div>

        <!-- 次へ -->
        <div>
          {% if page_obj.has_next %}
            <button type="button"
                    onclick="nextPage({{ page_obj.next_page_number }})"
                    class="inline-flex items-center justify-center bg-teamy-teal text-white px-10 py-3 rounded-full font-medium hover:opacity-90">
              次へ
            </button>
          {% endif %}
        </div>
      </div>

      <!-- 最終ページのみ：公開設定 + 回答終了 -->
      {% if not page_obj.has_next %}
        <div class="mt-10 flex flex-col items-center gap-6 max-w-2xl mx-auto">

          <label class="flex items-center gap-2 text-sm text-gray-600">
            <input type="checkbox"
                   name="is_profile_public"
                   value="true"
                   class="w-4 h-4 rounded border-gray-300">
            分析結果をチームメンバーに公開する
          </label>

          <button type="submit"
                  class="bg-teamy-orange text-white px-12 py-3 rounded-full font-medium hover:opacity-90">
            回答を終了する
          </button>

        </div>
      {% endif %}

      <!-- ===== ステップインジケーター ===== -->
      <div class="flex justify-center pt-8">
        <div class="relative flex items-center w-[360px]">
          <div class="absolute inset-x-0 top-1/2 h-[1px] bg-teamy-gray -translate-y-1/2"></div>

          {% for i in "12345678" %}
            <div
              class="relative z-10
                     {% if not forloop.first %}ml-auto{% endif %}
                     {% if forloop.counter == page_obj.number %}
                       flex items-center justify-center w-9 h-9 rounded-full
                       bg-teamy-navy text-white text-md font-bold
                     {% else %}
                       w-3 h-3 rounded-full bg-teamy-gray
                     {% endif %}">
              {% if forloop.counter == page_obj.number %}
                {{ forloop.counter }}
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

  </form>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'analysis/questions.js' %}"></script>
{% endblock %}
